<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Distributed QuEST: qubits_env_mpi.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>qubits_env_mpi.c File Reference</h1>
<p>An implementation of the API in <a class="el" href="qubits_8h.html" title="The QuEST library API and objects.">qubits.h</a> for an MPI environment.  
<a href="#_details">More...</a></p>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;omp.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="precision_8h_source.html">precision.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="qubits_8h_source.html">qubits.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="qubits__internal_8h_source.html">qubits_internal.h</a>&quot;</code><br/>

<p><a href="qubits__env__mpi_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ad3d8a3bd0c0b677acef144f2c2ef6d73">_BSD_SOURCE</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#af0ea25f00987af4c53f17c9cca62ab41">isChunkToSkipInFindPZero</a> (int chunkId, long long int chunkSize, int measureQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find chunks to skip when calculating probability of qubit being zero.  <a href="#af0ea25f00987af4c53f17c9cca62ab41"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6">chunkIsUpper</a> (int chunkId, long long int chunkSize, int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns whether a given chunk in position chunkId is in the upper or lower half of a block.  <a href="#a814c41ee59e206c362f2eaf1def88be6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#adb4b0373425b282abed27742d0ce0872">getRotAngle</a> (int chunkIsUpper, <a class="el" href="structComplex.html">Complex</a> *rot1, <a class="el" href="structComplex.html">Complex</a> *rot2, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get rotation values for a given chunk.  <a href="#adb4b0373425b282abed27742d0ce0872"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a">getChunkPairId</a> (int chunkIsUpper, int chunkId, long long int chunkSize, int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">get position of corresponding chunk, holding values required to update values in my chunk (with chunkId) when rotating rotQubit.  <a href="#af5bdeedf4a445b539d329c3000859f5a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7">halfMatrixBlockFitsInChunk</a> (long long int chunkSize, int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">return whether the current qubit rotation will use blocks that fit within a single chunk.  <a href="#a6d968d42f466bd03cea5edba456e10f7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a8605e6a6295174cb4661156eaa709ec4">getChunkIdFromIndex</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, long long int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ad84a3ce68d1ca02b4e3f741ea45b6054">initQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> *<a class="el" href="runTests_8c.html#a5fd8ba97fcae3408ae6221dfc3cc1f93">env</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize QuEST environment.  <a href="#ad84a3ce68d1ca02b4e3f741ea45b6054"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a8d31fe2d1ad4d01e2a1f5f6b8bc15b77">syncQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> <a class="el" href="runTests_8c.html#a5fd8ba97fcae3408ae6221dfc3cc1f93">env</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Guarantees that all code up to the given point has been executed on all nodes.  <a href="#a8d31fe2d1ad4d01e2a1f5f6b8bc15b77"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ac7e38d768a1bd79019f88cc1e6295092">syncQuESTSuccess</a> (int successCode)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Performs a logical AND on all successCodes held by all processes.  <a href="#ac7e38d768a1bd79019f88cc1e6295092"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#abd4bc926cd3f9b65610bb228d0c59fe0">closeQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> <a class="el" href="runTests_8c.html#a5fd8ba97fcae3408ae6221dfc3cc1f93">env</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close QuEST environment.  <a href="#abd4bc926cd3f9b65610bb228d0c59fe0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#af8a14ae79c3fb2c0b5f6255cc37bebf9">reportQuESTEnv</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> <a class="el" href="runTests_8c.html#a5fd8ba97fcae3408ae6221dfc3cc1f93">env</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Report information about the QuEST environment.  <a href="#af8a14ae79c3fb2c0b5f6255cc37bebf9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a62da5b58d8ce84e6f4d24be1b872294e">reportNodeList</a> (<a class="el" href="structQuESTEnv.html">QuESTEnv</a> <a class="el" href="runTests_8c.html#a5fd8ba97fcae3408ae6221dfc3cc1f93">env</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Report a list of CPU hostnames and the rank that is running on each if running with MPI enabled and an error message otherwise.  <a href="#a62da5b58d8ce84e6f4d24be1b872294e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">REAL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a317b786f577fa6bc136ea7f0ee7330a7">getRealAmpEl</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, long long int index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the real component of the probability amplitude at an index in the state vector.  <a href="#a317b786f577fa6bc136ea7f0ee7330a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">REAL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a3615f76fd5f57008d9b74bbd10533dd0">getImagAmpEl</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, long long int index)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the imaginary component of the probability amplitude at an index in the state vector.  <a href="#a3615f76fd5f57008d9b74bbd10533dd0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">REAL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a818a4c7cd7252d2b10b896b12fa431d3">calcTotalProbability</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Calculate the probability of being in any state by taking the norm of the entire state vector.  <a href="#a818a4c7cd7252d2b10b896b12fa431d3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a5c9b2f129bdffaaba9857f6eddecbb17">getRotAngleFromUnitaryMatrix</a> (int chunkIsUpper, <a class="el" href="structComplex.html">Complex</a> *rot1, <a class="el" href="structComplex.html">Complex</a> *rot2, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> u)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get rotation values for a given chunk given a unitary matrix.  <a href="#a5c9b2f129bdffaaba9857f6eddecbb17"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, int pairRank)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ad13ae1902276195d0df106116e032aff">compactUnitary</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit in the state vector of probability amplitudes.  <a href="#ad13ae1902276195d0df106116e032aff"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ae74806cf36513b6d8447439a5bc1d615">unitary</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> u)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a96cc5075cff975f73885b50c093ba4a0">controlledCompactUnitary</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit, const int controlQubit, <a class="el" href="structComplex.html">Complex</a> alpha, <a class="el" href="structComplex.html">Complex</a> beta)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit in the state vector of probability amplitudes.  <a href="#a96cc5075cff975f73885b50c093ba4a0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a4e135fd99abe7fa390c678937f0cebc9">controlledUnitary</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit, const int controlQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> u)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Apply a unitary operation to a single qubit given a control qubit Only perform the rotation for elements where the control qubit is one.  <a href="#a4e135fd99abe7fa390c678937f0cebc9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a1589779fdc2de60c784eabd8dd1c2a8c">multiControlledUnitary</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, int *controlQubits, const int numControlQubits, const int rotQubit, <a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a> u)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Apply a unitary operation to a single qubit given an array of control qubits Only perform the rotation for elements where all control qubits equal 1.  <a href="#a1589779fdc2de60c784eabd8dd1c2a8c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#acda82bebb0a62f419eec9c1e0575daad">sigmaX</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit by {{0,1},{1,0}} -- swap |0&gt; and |1&gt;.  <a href="#acda82bebb0a62f419eec9c1e0575daad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a4f8f372ee665363241313307bc028c45">controlledNot</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int controlQubit, const int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit by {{0,-i},{i,0}} -- swap |0&gt; and |1&gt; and apply a phase of -i or i, only for elements when control qubit is 1.  <a href="#a4f8f372ee665363241313307bc028c45"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a7b022c75cef77be046bd5d61e38a581e">sigmaY</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit by {{0,-i},{i,0}} -- swap |0&gt; and |1&gt; and apply a phase of -i or i.  <a href="#a7b022c75cef77be046bd5d61e38a581e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ae275b94c1a483dda43bf4ec947635605">phaseGate</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit, enum <a class="el" href="qubits_8h.html#a5739021c733cecc49647956b2f7338ea">phaseGateType</a> type)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit by {{1,0},{0,p}} where p is a phase term determined by the type argument.  <a href="#ae275b94c1a483dda43bf4ec947635605"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ad247d084dc7150893e9051a438a5807e">hadamard</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int rotQubit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rotate a single qubit by {{1,1},{1,-1}}/sqrt2 -- turn a |0&gt; into a |+&gt; and a |1&gt; into a |-&gt;.  <a href="#ad247d084dc7150893e9051a438a5807e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">REAL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ad315c941a51bc053d39ebfa2040fd32e">findProbabilityOfOutcome</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int measureQubit, int outcome)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find the probability of a specified qubit being in the zero or one state.  <a href="#ad315c941a51bc053d39ebfa2040fd32e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">REAL&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a07418ebac70fd9ae5d051d089961631d">collapseToOutcome</a> (<a class="el" href="structMultiQubit.html">MultiQubit</a> multiQubit, const int measureQubit, int outcome)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update the state vector to be consistent with measuring measureQubit=0 or measureQubit=1 according to the value of outcome.  <a href="#a07418ebac70fd9ae5d051d089961631d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#ae5f9019826f35e8b51b1716cfe397b45">exitWithError</a> (int errorCode, const char *func)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="qubits__env__mpi_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a> (int isValid, int errorCode, const char *func)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>An implementation of the API in <a class="el" href="qubits_8h.html" title="The QuEST library API and objects.">qubits.h</a> for an MPI environment. </p>

<p>Definition in file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ad3d8a3bd0c0b677acef144f2c2ef6d73"></a><!-- doxytag: member="qubits_env_mpi.c::_BSD_SOURCE" ref="ad3d8a3bd0c0b677acef144f2c2ef6d73" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _BSD_SOURCE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00005">5</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad72dbcf6d0153db1b8d8a58001feed83"></a><!-- doxytag: member="qubits_env_mpi.c::DEBUG" ref="ad72dbcf6d0153db1b8d8a58001feed83" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00018">18</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a818a4c7cd7252d2b10b896b12fa431d3"></a><!-- doxytag: member="qubits_env_mpi.c::calcTotalProbability" ref="a818a4c7cd7252d2b10b896b12fa431d3" args="(MultiQubit multiQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">REAL calcTotalProbability </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculate the probability of being in any state by taking the norm of the entire state vector. </p>
<p>Should be equal to 1. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing a set of qubits </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>total probability </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00108">108</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8c_source.html#l00015">DEBUG</a>, <a class="el" href="qubits_8h_source.html#l00014">ComplexArray::imag</a>, <a class="el" href="precision_8h_source.html#l00024">MPI_QuEST_REAL</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00053">MultiQubit::numChunks</a>, <a class="el" href="qubits_8h_source.html#l00013">ComplexArray::real</a>, <a class="el" href="precision_8h_source.html#l00023">REAL</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00341">test_compactUnitary()</a>, and <a class="el" href="runTests_8c_source.html#l00403">test_unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00108"></a>00108                                                 {
<a name="l00109"></a>00109   <span class="comment">/* IJB - implemented using Kahan summation for greater accuracy at a slight floating</span>
<a name="l00110"></a>00110 <span class="comment">     point operation overhead. For more details see https://en.wikipedia.org/wiki/Kahan_summation_algorithm */</span>
<a name="l00111"></a>00111   <span class="comment">/* Don&apos;t change the bracketing in this routine! */</span>
<a name="l00112"></a>00112   <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> pTotal=0; 
<a name="l00113"></a>00113   <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> y, t, c;
<a name="l00114"></a>00114   <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> allRankTotals=0;
<a name="l00115"></a>00115   <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> index;
<a name="l00116"></a>00116   <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> numAmpsPerRank = multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>;
<a name="l00117"></a>00117   c = 0.0;
<a name="l00118"></a>00118   <span class="keywordflow">for</span> (index=0; index&lt;numAmpsPerRank; index++){ 
<a name="l00119"></a>00119     <span class="comment">/* Perform pTotal+=multiQubit.stateVec.real[index]*multiQubit.stateVec.real[index]; by Kahan */</span>
<a name="l00120"></a>00120     y = multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a4195cac6c784ea1b6271f1c7dba1548a">real</a>[index]*multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a4195cac6c784ea1b6271f1c7dba1548a">real</a>[index] - c;
<a name="l00121"></a>00121     t = pTotal + y;
<a name="l00122"></a>00122     c = ( t - pTotal ) - y;
<a name="l00123"></a>00123     pTotal = t;
<a name="l00124"></a>00124     <span class="comment">/* Perform pTotal+=multiQubit.stateVec.imag[index]*multiQubit.stateVec.imag[index]; by Kahan */</span>
<a name="l00125"></a>00125     y = multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a79dde47c7ae530c79cebfdf57b225968">imag</a>[index]*multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a79dde47c7ae530c79cebfdf57b225968">imag</a>[index] - c;
<a name="l00126"></a>00126     t = pTotal + y;
<a name="l00127"></a>00127     c = ( t - pTotal ) - y;
<a name="l00128"></a>00128     pTotal = t;
<a name="l00129"></a>00129   } 
<a name="l00130"></a>00130   <span class="keywordflow">if</span> (<a class="code" href="qubits_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) printf(<span class="stringliteral">&quot;before calc prob. %d\n&quot;</span>, multiQubit.<a class="code" href="structMultiQubit.html#acd43f2f57991709c9e94f73662c972b2" title="Number of chunks the state vector is broken up into -- the number of MPI processes...">numChunks</a>);
<a name="l00131"></a>00131   <span class="keywordflow">if</span> (multiQubit.<a class="code" href="structMultiQubit.html#acd43f2f57991709c9e94f73662c972b2" title="Number of chunks the state vector is broken up into -- the number of MPI processes...">numChunks</a>&gt;1) MPI_Allreduce(&amp;pTotal, &amp;allRankTotals, 1, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>, MPI_SUM, MPI_COMM_WORLD);
<a name="l00132"></a>00132   <span class="keywordflow">else</span> allRankTotals=pTotal;
<a name="l00133"></a>00133   
<a name="l00134"></a>00134   <span class="keywordflow">return</span> allRankTotals;
<a name="l00135"></a>00135 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a814c41ee59e206c362f2eaf1def88be6"></a><!-- doxytag: member="qubits_env_mpi.c::chunkIsUpper" ref="a814c41ee59e206c362f2eaf1def88be6" args="(int chunkId, long long int chunkSize, int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int chunkIsUpper </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chunkId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>chunkSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns whether a given chunk in position chunkId is in the upper or lower half of a block. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkId</em>&nbsp;</td><td>id of chunk in state vector </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkSize</em>&nbsp;</td><td>number of amps in chunk </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit being rotated </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1: chunk is in upper half of block, 0: chunk is in lower half of block fix -- is this the same as isChunkToSkip? </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00146">146</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00271">compactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00353">controlledCompactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00515">controlledNot()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00396">controlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00601">hadamard()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00440">multiControlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00583">phaseGate()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00486">sigmaX()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00552">sigmaY()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00311">unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00147"></a>00147 {       
<a name="l00148"></a>00148         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeHalfBlock = 1LL &lt;&lt; (rotQubit);
<a name="l00149"></a>00149         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeBlock = sizeHalfBlock*2;
<a name="l00150"></a>00150         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> posInBlock = (chunkId*chunkSize) % sizeBlock;
<a name="l00151"></a>00151         <span class="keywordflow">return</span> posInBlock&lt;sizeHalfBlock;
<a name="l00152"></a>00152 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abd4bc926cd3f9b65610bb228d0c59fe0"></a><!-- doxytag: member="qubits_env_mpi.c::closeQuESTEnv" ref="abd4bc926cd3f9b65610bb228d0c59fe0" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void closeQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Close QuEST environment. </p>
<p>If something needs to be done to clean up the execution environment, such as finalizing MPI when running in distributed mode, it is handled here </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00056">56</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="3sat_8c_source.html#l00101">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00056"></a>00056                                 {
<a name="l00057"></a>00057         <span class="keywordtype">int</span> finalized;
<a name="l00058"></a>00058         MPI_Finalized(&amp;finalized);
<a name="l00059"></a>00059         <span class="keywordflow">if</span> (!finalized) MPI_Finalize();
<a name="l00060"></a>00060         <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;ERROR: Trying to close QuESTEnv multiple times. Ignoring\n&quot;</span>);
<a name="l00061"></a>00061 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a07418ebac70fd9ae5d051d089961631d"></a><!-- doxytag: member="qubits_env_mpi.c::collapseToOutcome" ref="a07418ebac70fd9ae5d051d089961631d" args="(MultiQubit multiQubit, const int measureQubit, int outcome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">REAL collapseToOutcome </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update the state vector to be consistent with measuring measureQubit=0 or measureQubit=1 according to the value of outcome. </p>
<p>Measure in Zero performs an irreversible change to the state vector: it updates the vector according to the event that an outcome has been measured on the qubit indicated by measureQubit (where his label starts from 0, of course). It achieves this by setting all inconsistent amplitudes to 0 and then renormalising based on the total probability of measuring measureQubit=0 if outcome=0 or measureQubit=1 if outcome=1. It then returns the probability of making this measurement.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>measureQubit</em>&nbsp;</td><td>qubit to measure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>outcome</em>&nbsp;</td><td>to measure the probability of and set the state to -- either zero or one </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>probability of qubit measureQubit being either zero or one </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00678">678</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits_8c_source.html#l02071">collapseToOutcomeDistributedRenorm()</a>, <a class="el" href="qubits_8c_source.html#l02114">collapseToOutcomeDistributedSetZero()</a>, <a class="el" href="qubits_8c_source.html#l01988">collapseToOutcomeLocal()</a>, <a class="el" href="qubits__env__local_8c_source.html#l00173">findProbabilityOfOutcome()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00650">isChunkToSkipInFindPZero()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="precision_8h_source.html#l00023">REAL</a>, and <a class="el" href="precision_8h_source.html#l00026">REAL_EPS</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00694">test_collapseToOutcome()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00679"></a>00679 {
<a name="l00680"></a>00680     <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(measureQubit &gt;= 0 &amp;&amp; measureQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 2, __func__);
<a name="l00681"></a>00681 
<a name="l00682"></a>00682         <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> totalStateProb=<a class="code" href="qubits_8h.html#ad315c941a51bc053d39ebfa2040fd32e" title="Find the probability of a specified qubit being in the zero or one state.">findProbabilityOfOutcome</a>(multiQubit, measureQubit, outcome);
<a name="l00683"></a>00683     <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(fabs(totalStateProb&gt;<a class="code" href="precision_8h.html#aebb5e6716e06431296af4d1a71744dec">REAL_EPS</a>), 8, __func__);
<a name="l00684"></a>00684 
<a name="l00685"></a>00685         <span class="keywordtype">int</span> skipValuesWithinRank = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, measureQubit);
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (skipValuesWithinRank) {
<a name="l00687"></a>00687         <a class="code" href="qubits_8c.html#a01d9a8b7ff0e09ec399e158389783aa9" title="Update the state vector to be consistent with measuring measureQubit=0 if outcome=0...">collapseToOutcomeLocal</a>(multiQubit, measureQubit, totalStateProb, outcome);
<a name="l00688"></a>00688     } <span class="keywordflow">else</span> {
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (!<a class="code" href="qubits__env__mpi_8c.html#af0ea25f00987af4c53f17c9cca62ab41" title="Find chunks to skip when calculating probability of qubit being zero.">isChunkToSkipInFindPZero</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, measureQubit)){
<a name="l00690"></a>00690             <span class="comment">// chunk has amps for q=0</span>
<a name="l00691"></a>00691             <span class="keywordflow">if</span> (outcome==0) <a class="code" href="qubits_8c.html#a7a1f63ec3c42d9ad72f1f01c14a885db" title="Renormalise parts of the state vector where measureQubit=0 or 1, based on the total...">collapseToOutcomeDistributedRenorm</a>(multiQubit, measureQubit, 
<a name="l00692"></a>00692                     totalStateProb);
<a name="l00693"></a>00693             <span class="keywordflow">else</span> <a class="code" href="qubits_8c.html#a78908fe8e75a21fd4f7fa7dff05d6be1" title="Set all amplitudes in one chunk to 0.">collapseToOutcomeDistributedSetZero</a>(multiQubit, measureQubit);
<a name="l00694"></a>00694         } <span class="keywordflow">else</span> {
<a name="l00695"></a>00695             <span class="comment">// chunk has amps for q=1</span>
<a name="l00696"></a>00696             <span class="keywordflow">if</span> (outcome==1) <a class="code" href="qubits_8c.html#a7a1f63ec3c42d9ad72f1f01c14a885db" title="Renormalise parts of the state vector where measureQubit=0 or 1, based on the total...">collapseToOutcomeDistributedRenorm</a>(multiQubit, measureQubit, 
<a name="l00697"></a>00697                     totalStateProb);
<a name="l00698"></a>00698             <span class="keywordflow">else</span> <a class="code" href="qubits_8c.html#a78908fe8e75a21fd4f7fa7dff05d6be1" title="Set all amplitudes in one chunk to 0.">collapseToOutcomeDistributedSetZero</a>(multiQubit, measureQubit);
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701         <span class="keywordflow">return</span> totalStateProb;
<a name="l00702"></a>00702 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad13ae1902276195d0df106116e032aff"></a><!-- doxytag: member="qubits_env_mpi.c::compactUnitary" ref="ad13ae1902276195d0df106116e032aff" args="(MultiQubit multiQubit, const int rotQubit, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compactUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit in the state vector of probability amplitudes. </p>
<p>Given two complex numbers alpha and beta, applies the operation <br/>
 [alpha, -beta* <br/>
 beta, alpha*] <br/>
</p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>Qubits are zero-based and the the first qubit is the rightmost</dd></dl>
<p>alpha, beta must obey |alpha|^2 + |beta|^2 = 1</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>alpha</em>&nbsp;</td><td>rotation angle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>beta</em>&nbsp;</td><td>rotation angle </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00271">271</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits_8c_source.html#l00646">compactUnitaryDistributed()</a>, <a class="el" href="qubits_8c_source.html#l00507">compactUnitaryLocal()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00167">getRotAngle()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>, and <a class="el" href="qubits_8c_source.html#l00408">validateAlphaBeta()</a>.</p>

<p>Referenced by <a class="el" href="qubits_8c_source.html#l00432">rotateAroundAxis()</a>, <a class="el" href="qubits_8c_source.html#l00450">rotateX()</a>, <a class="el" href="qubits_8c_source.html#l00469">rotateY()</a>, <a class="el" href="qubits_8c_source.html#l00488">rotateZ()</a>, <a class="el" href="runTests_8c_source.html#l00341">test_compactUnitary()</a>, and <a class="el" href="runTests_8c_source.html#l00403">test_unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00272"></a>00272 {
<a name="l00273"></a>00273         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00274"></a>00274         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(<a class="code" href="qubits_8c.html#ae2b2c14a07dd7d50ff86032a3ca101d7">validateAlphaBeta</a>(alpha, beta), 6, __func__);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00277"></a>00277         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00278"></a>00278         <a class="code" href="structComplex.html" title="Represents one complex number.">Complex</a> rot1, rot2;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00281"></a>00281         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00282"></a>00282         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00285"></a>00285                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00286"></a>00286                 <a class="code" href="qubits_8c.html#a33a8d60ae759d25a096c88b337db6c9f" title="Rotate a single qubit in the state vector of probability amplitudes.">compactUnitaryLocal</a>(multiQubit, rotQubit, alpha, beta);
<a name="l00287"></a>00287         } <span class="keywordflow">else</span> {
<a name="l00288"></a>00288                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00289"></a>00289                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00290"></a>00290                 <a class="code" href="qubits__env__mpi_8c.html#adb4b0373425b282abed27742d0ce0872" title="Get rotation values for a given chunk.">getRotAngle</a>(rankIsUpper, &amp;rot1, &amp;rot2, alpha, beta);
<a name="l00291"></a>00291                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00292"></a>00292                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00293"></a>00293                         <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. </span>
<a name="l00296"></a>00296                         <span class="comment">// send values to compactUnitaryDistributed in the correct order</span>
<a name="l00297"></a>00297                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00298"></a>00298                         <a class="code" href="qubits_8c.html#a6c49fefa672918a70b031923363cb580" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">compactUnitaryDistributed</a>(multiQubit,rotQubit,rot1,rot2,
<a name="l00299"></a>00299                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//upper</span>
<a name="l00300"></a>00300                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//lower</span>
<a name="l00301"></a>00301                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00302"></a>00302                 } <span class="keywordflow">else</span> {
<a name="l00303"></a>00303                         <a class="code" href="qubits_8c.html#a6c49fefa672918a70b031923363cb580" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">compactUnitaryDistributed</a>(multiQubit,rotQubit,rot1,rot2,
<a name="l00304"></a>00304                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//upper</span>
<a name="l00305"></a>00305                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//lower</span>
<a name="l00306"></a>00306                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00307"></a>00307                 }
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a96cc5075cff975f73885b50c093ba4a0"></a><!-- doxytag: member="qubits_env_mpi.c::controlledCompactUnitary" ref="a96cc5075cff975f73885b50c093ba4a0" args="(MultiQubit multiQubit, const int rotQubit, const int controlQubit, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void controlledCompactUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit in the state vector of probability amplitudes. </p>
<p>Given two complex numbers alpha and beta and a control qubit, applies the operation: <br/>
 [alpha, -beta* <br/>
 beta, alpha*] <br/>
 Only when the control qubit is one.</p>
<dl class="remark"><dt><b>Remarks:</b></dt><dd>Qubits are zero-based and the the first qubit is the rightmost</dd></dl>
<p>alpha, beta must obey |alpha|^2 + |beta|^2 = 1</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>controlQubit</em>&nbsp;</td><td>perform rotation if this qubit is 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>alpha</em>&nbsp;</td><td>rotation angle </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>beta</em>&nbsp;</td><td>rotation angle </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00353">353</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits_8c_source.html#l00991">controlledCompactUnitaryDistributed()</a>, <a class="el" href="qubits_8c_source.html#l00760">controlledCompactUnitaryLocal()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00167">getRotAngle()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>, and <a class="el" href="qubits_8c_source.html#l00408">validateAlphaBeta()</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00470">test_controlledCompactUnitary()</a>, <a class="el" href="runTests_8c_source.html#l00515">test_controlledUnitary()</a>, and <a class="el" href="runTests_8c_source.html#l00567">test_multiControlledUnitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00354"></a>00354 {
<a name="l00355"></a>00355         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00356"></a>00356         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(controlQubit &gt;= 0 &amp;&amp; controlQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 2, __func__);
<a name="l00357"></a>00357         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(controlQubit != rotQubit, 3, __func__);
<a name="l00358"></a>00358         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(<a class="code" href="qubits_8c.html#ae2b2c14a07dd7d50ff86032a3ca101d7">validateAlphaBeta</a>(alpha, beta), 6, __func__);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00361"></a>00361         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00362"></a>00362         <a class="code" href="structComplex.html" title="Represents one complex number.">Complex</a> rot1, rot2;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00365"></a>00365         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00366"></a>00366         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00367"></a>00367 
<a name="l00368"></a>00368         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00369"></a>00369                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00370"></a>00370                 <a class="code" href="qubits_8c.html#a2f5b808392caec4eb775bb3aabfa25d2" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">controlledCompactUnitaryLocal</a>(multiQubit, rotQubit, controlQubit, alpha, beta);
<a name="l00371"></a>00371         } <span class="keywordflow">else</span> {
<a name="l00372"></a>00372                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00373"></a>00373                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00374"></a>00374                 <a class="code" href="qubits__env__mpi_8c.html#adb4b0373425b282abed27742d0ce0872" title="Get rotation values for a given chunk.">getRotAngle</a>(rankIsUpper, &amp;rot1, &amp;rot2, alpha, beta);
<a name="l00375"></a>00375                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00376"></a>00376                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00377"></a>00377                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00378"></a>00378                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00379"></a>00379                 
<a name="l00380"></a>00380                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. send values to controlledCompactUnitaryDistributed</span>
<a name="l00381"></a>00381                 <span class="comment">// in the correct order</span>
<a name="l00382"></a>00382                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00383"></a>00383                         <a class="code" href="qubits_8c.html#ac874e5c65f9bbb64fa3058a7638bfc15" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">controlledCompactUnitaryDistributed</a>(multiQubit,rotQubit,controlQubit,rot1,rot2,
<a name="l00384"></a>00384                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//upper</span>
<a name="l00385"></a>00385                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//lower</span>
<a name="l00386"></a>00386                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00387"></a>00387                 } <span class="keywordflow">else</span> {
<a name="l00388"></a>00388                         <a class="code" href="qubits_8c.html#ac874e5c65f9bbb64fa3058a7638bfc15" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">controlledCompactUnitaryDistributed</a>(multiQubit,rotQubit,controlQubit,rot1,rot2,
<a name="l00389"></a>00389                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//upper</span>
<a name="l00390"></a>00390                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//lower</span>
<a name="l00391"></a>00391                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00392"></a>00392                 }
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4f8f372ee665363241313307bc028c45"></a><!-- doxytag: member="qubits_env_mpi.c::controlledNot" ref="a4f8f372ee665363241313307bc028c45" args="(MultiQubit multiQubit, const int controlQubit, const int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void controlledNot </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>targetQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit by {{0,-i},{i,0}} -- swap |0&gt; and |1&gt; and apply a phase of -i or i, only for elements when control qubit is 1. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>controlQubit</em>&nbsp;</td><td>perform sigmaX rotation if this qubit is 1 </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00515">515</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits_8c_source.html#l01338">controlledNotDistributed()</a>, <a class="el" href="qubits_8c_source.html#l01272">controlledNotLocal()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00249">test_controlledNot()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00516"></a>00516 {
<a name="l00517"></a>00517         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00518"></a>00518         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(controlQubit &gt;= 0 &amp;&amp; controlQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 2, __func__);
<a name="l00519"></a>00519         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(controlQubit != rotQubit, 3, __func__);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00522"></a>00522         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00525"></a>00525         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00526"></a>00526         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00527"></a>00527 
<a name="l00528"></a>00528         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00529"></a>00529                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00530"></a>00530                 <a class="code" href="qubits_8c.html#ad357a43e80e3baf013975b1b70942f4c" title="Rotate a single qubit by {{0,1},{1,0} for elements where controlQubit is one.">controlledNotLocal</a>(multiQubit, controlQubit, rotQubit);
<a name="l00531"></a>00531         } <span class="keywordflow">else</span> {
<a name="l00532"></a>00532                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00533"></a>00533                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00534"></a>00534                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00535"></a>00535                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00536"></a>00536                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00537"></a>00537                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00538"></a>00538                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. send values to controlledNot</span>
<a name="l00539"></a>00539                 <span class="comment">// in the correct order</span>
<a name="l00540"></a>00540                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00541"></a>00541                         <a class="code" href="qubits_8c.html#a05875a70b539a3efb28d027823403f34" title="Rotate a single qubit by {{0,1},{1,0}.">controlledNotDistributed</a>(multiQubit,controlQubit,rotQubit,
<a name="l00542"></a>00542                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//in</span>
<a name="l00543"></a>00543                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//out</span>
<a name="l00544"></a>00544                 } <span class="keywordflow">else</span> {
<a name="l00545"></a>00545                         <a class="code" href="qubits_8c.html#a05875a70b539a3efb28d027823403f34" title="Rotate a single qubit by {{0,1},{1,0}.">controlledNotDistributed</a>(multiQubit,controlQubit,rotQubit,
<a name="l00546"></a>00546                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//in</span>
<a name="l00547"></a>00547                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//out</span>
<a name="l00548"></a>00548                 }
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4e135fd99abe7fa390c678937f0cebc9"></a><!-- doxytag: member="qubits_env_mpi.c::controlledUnitary" ref="a4e135fd99abe7fa390c678937f0cebc9" args="(MultiQubit multiQubit, const int rotQubit, const int controlQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void controlledUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>controlQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply a unitary operation to a single qubit given a control qubit Only perform the rotation for elements where the control qubit is one. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>controlQubit</em>&nbsp;</td><td>perform rotation if this qubit is 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>u</em>&nbsp;</td><td>unitary matrix to apply </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00396">396</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits_8c_source.html#l01054">controlledUnitaryDistributed()</a>, <a class="el" href="qubits_8c_source.html#l00912">controlledUnitaryLocal()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00192">getRotAngleFromUnitaryMatrix()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>, and <a class="el" href="qubits_8c_source.html#l00383">validateMatrixIsUnitary()</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00515">test_controlledUnitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00398"></a>00398 {
<a name="l00399"></a>00399         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00400"></a>00400         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(controlQubit &gt;= 0 &amp;&amp; controlQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 2, __func__);
<a name="l00401"></a>00401         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(controlQubit != rotQubit, 3, __func__);
<a name="l00402"></a>00402         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(<a class="code" href="qubits_8c.html#ae4fea133d1a8f09ff8da03038100adb2">validateMatrixIsUnitary</a>(u), 5, __func__);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00405"></a>00405         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00406"></a>00406         <a class="code" href="structComplex.html" title="Represents one complex number.">Complex</a> rot1, rot2;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00409"></a>00409         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00410"></a>00410         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00411"></a>00411 
<a name="l00412"></a>00412         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00413"></a>00413                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00414"></a>00414                 <a class="code" href="qubits_8c.html#a0af39b13cf3a043975fce768f3507657" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">controlledUnitaryLocal</a>(multiQubit, rotQubit, controlQubit, u);
<a name="l00415"></a>00415         } <span class="keywordflow">else</span> {
<a name="l00416"></a>00416                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00417"></a>00417                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00418"></a>00418                 <a class="code" href="qubits__env__mpi_8c.html#a5c9b2f129bdffaaba9857f6eddecbb17" title="Get rotation values for a given chunk given a unitary matrix.">getRotAngleFromUnitaryMatrix</a>(rankIsUpper, &amp;rot1, &amp;rot2, u);
<a name="l00419"></a>00419                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00420"></a>00420                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00421"></a>00421                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00422"></a>00422                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00423"></a>00423                 
<a name="l00424"></a>00424                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. send values to controlledUnitaryDistributed</span>
<a name="l00425"></a>00425                 <span class="comment">// in the correct order</span>
<a name="l00426"></a>00426                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00427"></a>00427                         <a class="code" href="qubits_8c.html#a9903d9da1c523a84728e4e4870f22949" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">controlledUnitaryDistributed</a>(multiQubit,rotQubit,controlQubit,rot1,rot2,
<a name="l00428"></a>00428                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//upper</span>
<a name="l00429"></a>00429                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//lower</span>
<a name="l00430"></a>00430                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00431"></a>00431                 } <span class="keywordflow">else</span> {
<a name="l00432"></a>00432                         <a class="code" href="qubits_8c.html#a9903d9da1c523a84728e4e4870f22949" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">controlledUnitaryDistributed</a>(multiQubit,rotQubit,controlQubit,rot1,rot2,
<a name="l00433"></a>00433                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//upper</span>
<a name="l00434"></a>00434                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//lower</span>
<a name="l00435"></a>00435                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00436"></a>00436                 }
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7682c9a3fd592d34ec15ba8fa172f104"></a><!-- doxytag: member="qubits_env_mpi.c::exchangeStateVectors" ref="a7682c9a3fd592d34ec15ba8fa172f104" args="(MultiQubit multiQubit, int pairRank)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void exchangeStateVectors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pairRank</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00239">239</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8c_source.html#l00015">DEBUG</a>, <a class="el" href="qubits_8h_source.html#l00014">ComplexArray::imag</a>, <a class="el" href="precision_8h_source.html#l00024">MPI_QuEST_REAL</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits_8h_source.html#l00013">ComplexArray::real</a>, <a class="el" href="precision_8h_source.html#l00023">REAL</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00271">compactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00353">controlledCompactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00515">controlledNot()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00396">controlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00601">hadamard()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00440">multiControlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00486">sigmaX()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00552">sigmaY()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00311">unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00239"></a>00239                                                               {
<a name="l00240"></a>00240         <span class="comment">// MPI send/receive vars</span>
<a name="l00241"></a>00241         <span class="keywordtype">int</span> TAG=100;
<a name="l00242"></a>00242         MPI_Status status;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="comment">// Multiple messages are required as MPI uses int rather than long long int for count</span>
<a name="l00245"></a>00245         <span class="comment">// For openmpi, messages are further restricted to 2GB in size -- do this for all cases</span>
<a name="l00246"></a>00246         <span class="comment">// to be safe</span>
<a name="l00247"></a>00247         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> maxMessageCount = 1LL&lt;&lt;29;
<a name="l00248"></a>00248         <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a>)==8) maxMessageCount = (1LL&lt;&lt;28);
<a name="l00249"></a>00249         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(<a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a>)==16) maxMessageCount = (1LL&lt;&lt;27);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>&lt;maxMessageCount) maxMessageCount = multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>;
<a name="l00252"></a>00252         <span class="keywordtype">int</span> numMessages = multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>/maxMessageCount;
<a name="l00253"></a>00253         <span class="keywordtype">int</span> i;
<a name="l00254"></a>00254         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> offset;
<a name="l00255"></a>00255         <span class="keywordflow">if</span> (<a class="code" href="qubits_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) printf(<span class="stringliteral">&quot;numMessages %d maxMessageCount %lld\n&quot;</span>, numMessages, maxMessageCount);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="comment">// send my state vector to pairRank&apos;s multiQubit.pairStateVec</span>
<a name="l00258"></a>00258         <span class="comment">// receive pairRank&apos;s state vector into multiQubit.pairStateVec</span>
<a name="l00259"></a>00259         <span class="keywordflow">for</span> (i=0; i&lt;numMessages; i++){
<a name="l00260"></a>00260                 offset = i*maxMessageCount;
<a name="l00261"></a>00261                 MPI_Sendrecv(&amp;multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a4195cac6c784ea1b6271f1c7dba1548a">real</a>[offset], maxMessageCount, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>, pairRank, TAG,
<a name="l00262"></a>00262                                  &amp;multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.<a class="code" href="structComplexArray.html#a4195cac6c784ea1b6271f1c7dba1548a">real</a>[offset], maxMessageCount, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>,
<a name="l00263"></a>00263                                  pairRank, TAG, MPI_COMM_WORLD, &amp;status);
<a name="l00264"></a>00264                 <span class="comment">//printf(&quot;rank: %d err: %d\n&quot;, multiQubit.rank, err);</span>
<a name="l00265"></a>00265                 MPI_Sendrecv(&amp;multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a79dde47c7ae530c79cebfdf57b225968">imag</a>[offset], maxMessageCount, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>, pairRank, TAG,
<a name="l00266"></a>00266                                 &amp;multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>.<a class="code" href="structComplexArray.html#a79dde47c7ae530c79cebfdf57b225968">imag</a>[offset], maxMessageCount, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>,
<a name="l00267"></a>00267                                 pairRank, TAG, MPI_COMM_WORLD, &amp;status);
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae5f9019826f35e8b51b1716cfe397b45"></a><!-- doxytag: member="qubits_env_mpi.c::exitWithError" ref="ae5f9019826f35e8b51b1716cfe397b45" args="(int errorCode, const char *func)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void exitWithError </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>errorCode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00704">704</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8c_source.html#l00017">errorCodes</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00704"></a>00704                                                    {
<a name="l00705"></a>00705     printf(<span class="stringliteral">&quot;!!!\n&quot;</span>);
<a name="l00706"></a>00706     printf(<span class="stringliteral">&quot;QuEST Error in function %s: %s\n&quot;</span>, func, <a class="code" href="qubits_8c.html#aac1637696885c75b73a1ecf381cea713">errorCodes</a>[errorCode]);
<a name="l00707"></a>00707     printf(<span class="stringliteral">&quot;!!!\n&quot;</span>);
<a name="l00708"></a>00708     printf(<span class="stringliteral">&quot;exiting..\n&quot;</span>);
<a name="l00709"></a>00709     MPI_Abort(MPI_COMM_WORLD, errorCode);
<a name="l00710"></a>00710 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad315c941a51bc053d39ebfa2040fd32e"></a><!-- doxytag: member="qubits_env_mpi.c::findProbabilityOfOutcome" ref="ad315c941a51bc053d39ebfa2040fd32e" args="(MultiQubit multiQubit, const int measureQubit, int outcome)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">REAL findProbabilityOfOutcome </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outcome</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the probability of a specified qubit being in the zero or one state. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>measureQubit</em>&nbsp;</td><td>qubit to measure </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>outcome</em>&nbsp;</td><td>to measure the probability of -- either zero or one </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>probability of qubit measureQubit being either zero or one </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00659">659</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits_8c_source.html#l01830">findProbabilityOfZeroDistributed()</a>, <a class="el" href="qubits_8c_source.html#l01757">findProbabilityOfZeroLocal()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00650">isChunkToSkipInFindPZero()</a>, <a class="el" href="precision_8h_source.html#l00024">MPI_QuEST_REAL</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, and <a class="el" href="precision_8h_source.html#l00023">REAL</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__local_8c_source.html#l00182">collapseToOutcome()</a>, <a class="el" href="3sat_8c_source.html#l00101">main()</a>, and <a class="el" href="runTests_8c_source.html#l00649">test_findProbabilityOfOutcome()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00660"></a>00660 {
<a name="l00661"></a>00661     <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(measureQubit &gt;= 0 &amp;&amp; measureQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 2, __func__);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663         <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> stateProb=0, totalStateProb=0;
<a name="l00664"></a>00664         <span class="keywordtype">int</span> skipValuesWithinRank = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, measureQubit);
<a name="l00665"></a>00665         <span class="keywordflow">if</span> (skipValuesWithinRank) {
<a name="l00666"></a>00666                 stateProb = <a class="code" href="qubits_8c.html#a7c02cd0e1b4eac19771a0525f023249e" title="Measure the total probability of a specified qubit being in the zero state across...">findProbabilityOfZeroLocal</a>(multiQubit, measureQubit);
<a name="l00667"></a>00667         } <span class="keywordflow">else</span> {
<a name="l00668"></a>00668                 <span class="keywordflow">if</span> (!<a class="code" href="qubits__env__mpi_8c.html#af0ea25f00987af4c53f17c9cca62ab41" title="Find chunks to skip when calculating probability of qubit being zero.">isChunkToSkipInFindPZero</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, measureQubit)){
<a name="l00669"></a>00669                         stateProb = <a class="code" href="qubits_8c.html#a9ac9bb717a889f09d307eda9f0b65957" title="Measure the probability of a specified qubit being in the zero state across all amplitudes...">findProbabilityOfZeroDistributed</a>(multiQubit, measureQubit);
<a name="l00670"></a>00670                 } <span class="keywordflow">else</span> stateProb = 0;
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672         MPI_Allreduce(&amp;stateProb, &amp;totalStateProb, 1, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>, MPI_SUM, MPI_COMM_WORLD);
<a name="l00673"></a>00673         <span class="keywordflow">if</span> (outcome==1) totalStateProb = 1.0 - totalStateProb;
<a name="l00674"></a>00674         <span class="keywordflow">return</span> totalStateProb;
<a name="l00675"></a>00675 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8605e6a6295174cb4661156eaa709ec4"></a><!-- doxytag: member="qubits_env_mpi.c::getChunkIdFromIndex" ref="a8605e6a6295174cb4661156eaa709ec4" args="(MultiQubit multiQubit, long long int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getChunkIdFromIndex </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00084">84</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00098">getImagAmpEl()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00088">getRealAmpEl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084                                                                    {
<a name="l00085"></a>00085         <span class="keywordflow">return</span> index/multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>; <span class="comment">// this is numAmpsPerChunk</span>
<a name="l00086"></a>00086 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af5bdeedf4a445b539d329c3000859f5a"></a><!-- doxytag: member="qubits_env_mpi.c::getChunkPairId" ref="af5bdeedf4a445b539d329c3000859f5a" args="(int chunkIsUpper, int chunkId, long long int chunkSize, int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int getChunkPairId </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chunkIsUpper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chunkId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>chunkSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>get position of corresponding chunk, holding values required to update values in my chunk (with chunkId) when rotating rotQubit. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkIsUpper</em>&nbsp;</td><td>1: chunk is in upper half of block, 0: chunk is in lower half </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkId</em>&nbsp;</td><td>id of chunk in state vector </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkSize</em>&nbsp;</td><td>number of amps in chunk </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit being rotated </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>chunkId of chunk required to rotate rotQubit </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00213">213</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00271">compactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00353">controlledCompactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00515">controlledNot()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00396">controlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00601">hadamard()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00440">multiControlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00486">sigmaX()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00552">sigmaY()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00311">unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00214"></a>00214 {
<a name="l00215"></a>00215         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeHalfBlock = 1LL &lt;&lt; (rotQubit);
<a name="l00216"></a>00216         <span class="keywordtype">int</span> chunksPerHalfBlock = sizeHalfBlock/chunkSize;
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (<a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>){
<a name="l00218"></a>00218                 <span class="keywordflow">return</span> chunkId + chunksPerHalfBlock;
<a name="l00219"></a>00219         } <span class="keywordflow">else</span> {
<a name="l00220"></a>00220                 <span class="keywordflow">return</span> chunkId - chunksPerHalfBlock;
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3615f76fd5f57008d9b74bbd10533dd0"></a><!-- doxytag: member="qubits_env_mpi.c::getImagAmpEl" ref="a3615f76fd5f57008d9b74bbd10533dd0" args="(MultiQubit multiQubit, long long int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">REAL getImagAmpEl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the imaginary component of the probability amplitude at an index in the state vector. </p>
<p>For debugging purposes. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing a set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>index</em>&nbsp;</td><td>index in state vector of probability amplitudes </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>imaginary component at that index </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00098">98</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00084">getChunkIdFromIndex()</a>, <a class="el" href="qubits_8h_source.html#l00014">ComplexArray::imag</a>, <a class="el" href="precision_8h_source.html#l00024">MPI_QuEST_REAL</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="precision_8h_source.html#l00023">REAL</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="qubits_8c_source.html#l02150">getProbEl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00098"></a>00098                                                              {
<a name="l00099"></a>00099         <span class="keywordtype">int</span> chunkId = <a class="code" href="qubits__env__mpi_8c.html#a8605e6a6295174cb4661156eaa709ec4">getChunkIdFromIndex</a>(multiQubit, index);
<a name="l00100"></a>00100         <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> el; 
<a name="l00101"></a>00101         <span class="keywordflow">if</span> (multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>==chunkId){
<a name="l00102"></a>00102                 el = multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a79dde47c7ae530c79cebfdf57b225968">imag</a>[index-chunkId*multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>];
<a name="l00103"></a>00103         }
<a name="l00104"></a>00104         MPI_Bcast(&amp;el, 1, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>, chunkId, MPI_COMM_WORLD);
<a name="l00105"></a>00105         <span class="keywordflow">return</span> el; 
<a name="l00106"></a>00106 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a317b786f577fa6bc136ea7f0ee7330a7"></a><!-- doxytag: member="qubits_env_mpi.c::getRealAmpEl" ref="a317b786f577fa6bc136ea7f0ee7330a7" args="(MultiQubit multiQubit, long long int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">REAL getRealAmpEl </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the real component of the probability amplitude at an index in the state vector. </p>
<p>For debugging purposes. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing a set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>index</em>&nbsp;</td><td>index in state vector of probability amplitudes </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>real component at that index </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00088">88</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00084">getChunkIdFromIndex()</a>, <a class="el" href="precision_8h_source.html#l00024">MPI_QuEST_REAL</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00013">ComplexArray::real</a>, <a class="el" href="precision_8h_source.html#l00023">REAL</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="qubits_8c_source.html#l02150">getProbEl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00088"></a>00088                                                              {
<a name="l00089"></a>00089         <span class="keywordtype">int</span> chunkId = <a class="code" href="qubits__env__mpi_8c.html#a8605e6a6295174cb4661156eaa709ec4">getChunkIdFromIndex</a>(multiQubit, index);
<a name="l00090"></a>00090         <a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a> el; 
<a name="l00091"></a>00091         <span class="keywordflow">if</span> (multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>==chunkId){
<a name="l00092"></a>00092                 el = multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>.<a class="code" href="structComplexArray.html#a4195cac6c784ea1b6271f1c7dba1548a">real</a>[index-chunkId*multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>];
<a name="l00093"></a>00093         }
<a name="l00094"></a>00094         MPI_Bcast(&amp;el, 1, <a class="code" href="precision_8h.html#a750ad290949ef7dc4afdfbd8231a5057">MPI_QuEST_REAL</a>, chunkId, MPI_COMM_WORLD);
<a name="l00095"></a>00095         <span class="keywordflow">return</span> el; 
<a name="l00096"></a>00096 } 
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb4b0373425b282abed27742d0ce0872"></a><!-- doxytag: member="qubits_env_mpi.c::getRotAngle" ref="adb4b0373425b282abed27742d0ce0872" args="(int chunkIsUpper, Complex *rot1, Complex *rot2, Complex alpha, Complex beta)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void getRotAngle </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chunkIsUpper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a> *&nbsp;</td>
          <td class="paramname"> <em>rot1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a> *&nbsp;</td>
          <td class="paramname"> <em>rot2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a>&nbsp;</td>
          <td class="paramname"> <em>beta</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get rotation values for a given chunk. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkIsUpper</em>&nbsp;</td><td>1: chunk is in upper half of block, 0: chunk is in lower half</td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>rot1,rot2</em>&nbsp;</td><td>rotation values to use, allocated for upper/lower such that </p>
<div class="fragment"><pre class="fragment">
stateUpper = rot1 * stateUpper + conj(rot2)  * stateLower
</pre></div><p> or </p>
<div class="fragment"><pre class="fragment">
stateLower = rot1 * stateUpper + conj(rot2)  * stateLower
</pre></div> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>alpha,beta</em>&nbsp;</td><td>initial rotation values </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00167">167</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00022">Complex::imag</a>, and <a class="el" href="qubits_8h_source.html#l00021">Complex::real</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00271">compactUnitary()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00353">controlledCompactUnitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00168"></a>00168 {
<a name="l00169"></a>00169         <span class="keywordflow">if</span> (<a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>){
<a name="l00170"></a>00170                 *rot1=alpha;
<a name="l00171"></a>00171                 rot2-&gt;<a class="code" href="structComplex.html#a479ad939835457595fcca3ca55c06283">real</a>=-beta.<a class="code" href="structComplex.html#a479ad939835457595fcca3ca55c06283">real</a>;
<a name="l00172"></a>00172                 rot2-&gt;<a class="code" href="structComplex.html#a1151948284b21c0052f203f23ab931d9">imag</a>=-beta.<a class="code" href="structComplex.html#a1151948284b21c0052f203f23ab931d9">imag</a>;
<a name="l00173"></a>00173         } <span class="keywordflow">else</span> {
<a name="l00174"></a>00174                 *rot1=beta;
<a name="l00175"></a>00175                 *rot2=alpha;
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c9b2f129bdffaaba9857f6eddecbb17"></a><!-- doxytag: member="qubits_env_mpi.c::getRotAngleFromUnitaryMatrix" ref="a5c9b2f129bdffaaba9857f6eddecbb17" args="(int chunkIsUpper, Complex *rot1, Complex *rot2, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void getRotAngleFromUnitaryMatrix </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chunkIsUpper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a> *&nbsp;</td>
          <td class="paramname"> <em>rot1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplex.html">Complex</a> *&nbsp;</td>
          <td class="paramname"> <em>rot2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get rotation values for a given chunk given a unitary matrix. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkIsUpper</em>&nbsp;</td><td>1: chunk is in upper half of block, 0: chunk is in lower half</td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>rot1,rot2</em>&nbsp;</td><td>rotation values to use, allocated for upper/lower such that </p>
<div class="fragment"><pre class="fragment">
stateUpper = rot1 * stateUpper + conj(rot2)  * stateLower
</pre></div><p> or </p>
<div class="fragment"><pre class="fragment">
stateLower = rot1 * stateUpper + conj(rot2)  * stateLower
</pre></div> </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>u</em>&nbsp;</td><td>unitary matrix operation </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00192">192</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00027">ComplexMatrix2::r0c0</a>, <a class="el" href="qubits_8h_source.html#l00027">ComplexMatrix2::r0c1</a>, <a class="el" href="qubits_8h_source.html#l00028">ComplexMatrix2::r1c0</a>, and <a class="el" href="qubits_8h_source.html#l00028">ComplexMatrix2::r1c1</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00396">controlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00440">multiControlledUnitary()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00311">unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00193"></a>00193 {
<a name="l00194"></a>00194         <span class="keywordflow">if</span> (<a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>){
<a name="l00195"></a>00195                 *rot1=u.<a class="code" href="structComplexMatrix2.html#ae72b4458233b077a636beee1892e81ff">r0c0</a>;
<a name="l00196"></a>00196                 *rot2=u.<a class="code" href="structComplexMatrix2.html#a0f3932f055a8b05cef361bce25d51172">r0c1</a>;
<a name="l00197"></a>00197         } <span class="keywordflow">else</span> {
<a name="l00198"></a>00198                 *rot1=u.<a class="code" href="structComplexMatrix2.html#ab98282015ed2065e53fbc9638e2583ab">r1c0</a>;
<a name="l00199"></a>00199                 *rot2=u.<a class="code" href="structComplexMatrix2.html#a763007c3070802373549ba0350f83c8a">r1c1</a>;
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad247d084dc7150893e9051a438a5807e"></a><!-- doxytag: member="qubits_env_mpi.c::hadamard" ref="ad247d084dc7150893e9051a438a5807e" args="(MultiQubit multiQubit, const int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hadamard </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit by {{1,1},{1,-1}}/sqrt2 -- turn a |0&gt; into a |+&gt; and a |1&gt; into a |-&gt;. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00601">601</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits_8c_source.html#l01544">hadamardDistributed()</a>, <a class="el" href="qubits_8c_source.html#l01482">hadamardLocal()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00165">test_hadamard()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00606"></a>00606         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00609"></a>00609         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00610"></a>00610         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00611"></a>00611 
<a name="l00612"></a>00612         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00613"></a>00613                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00614"></a>00614                 <a class="code" href="qubits_8c.html#a0711416fceaf63c67b496e123e845c69" title="Rotate a single qubit by {{1,1},{1,-1}}/sqrt2.">hadamardLocal</a>(multiQubit, rotQubit);
<a name="l00615"></a>00615         } <span class="keywordflow">else</span> {
<a name="l00616"></a>00616                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00617"></a>00617                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00618"></a>00618                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00619"></a>00619                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00620"></a>00620                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00621"></a>00621                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00622"></a>00622                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. send values to hadamardDistributed</span>
<a name="l00623"></a>00623                 <span class="comment">// in the correct order</span>
<a name="l00624"></a>00624                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00625"></a>00625                         <a class="code" href="qubits_8c.html#ac835c194bd547240a35f0b028db1d658" title="Rotate a single qubit by {{1,1},{1,-1}}/sqrt2.">hadamardDistributed</a>(multiQubit,rotQubit,
<a name="l00626"></a>00626                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//upper</span>
<a name="l00627"></a>00627                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//lower</span>
<a name="l00628"></a>00628                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, rankIsUpper); <span class="comment">//output</span>
<a name="l00629"></a>00629                 } <span class="keywordflow">else</span> {
<a name="l00630"></a>00630                         <a class="code" href="qubits_8c.html#ac835c194bd547240a35f0b028db1d658" title="Rotate a single qubit by {{1,1},{1,-1}}/sqrt2.">hadamardDistributed</a>(multiQubit,rotQubit,
<a name="l00631"></a>00631                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//upper</span>
<a name="l00632"></a>00632                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//lower</span>
<a name="l00633"></a>00633                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, rankIsUpper); <span class="comment">//output</span>
<a name="l00634"></a>00634                 }
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d968d42f466bd03cea5edba456e10f7"></a><!-- doxytag: member="qubits_env_mpi.c::halfMatrixBlockFitsInChunk" ref="a6d968d42f466bd03cea5edba456e10f7" args="(long long int chunkSize, int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int halfMatrixBlockFitsInChunk </td>
          <td>(</td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>chunkSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return whether the current qubit rotation will use blocks that fit within a single chunk. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkSize</em>&nbsp;</td><td>number of amps in chunk </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit being rotated </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1: one chunk fits in one block 0: chunk is larger than block </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00232">232</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00678">collapseToOutcome()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00271">compactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00353">controlledCompactUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00515">controlledNot()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00396">controlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00659">findProbabilityOfOutcome()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00601">hadamard()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00440">multiControlledUnitary()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00583">phaseGate()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00486">sigmaX()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00552">sigmaY()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00311">unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00233"></a>00233 {
<a name="l00234"></a>00234         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeHalfBlock = 1LL &lt;&lt; (rotQubit);
<a name="l00235"></a>00235         <span class="keywordflow">if</span> (chunkSize &gt; sizeHalfBlock) <span class="keywordflow">return</span> 1;
<a name="l00236"></a>00236         <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;
<a name="l00237"></a>00237 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad84a3ce68d1ca02b4e3f741ea45b6054"></a><!-- doxytag: member="qubits_env_mpi.c::initQuESTEnv" ref="ad84a3ce68d1ca02b4e3f741ea45b6054" args="(QuESTEnv *env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a> *&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize QuEST environment. </p>
<p>If something needs to be done to set up the execution environment, such as initializing MPI when running in distributed mode, it is handled here </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00026">26</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8c_source.html#l00015">DEBUG</a>, <a class="el" href="qubits_8h_source.html#l00062">QuESTEnv::numRanks</a>, and <a class="el" href="qubits_8h_source.html#l00061">QuESTEnv::rank</a>.</p>

<p>Referenced by <a class="el" href="3sat_8c_source.html#l00101">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00026"></a>00026                                 {
<a name="l00027"></a>00027         <span class="comment">// init MPI environment</span>
<a name="l00028"></a>00028         <span class="keywordtype">int</span> rank, numRanks, initialized;
<a name="l00029"></a>00029         MPI_Initialized(&amp;initialized);
<a name="l00030"></a>00030         <span class="keywordflow">if</span> (!initialized){
<a name="l00031"></a>00031                 MPI_Init(NULL, NULL);
<a name="l00032"></a>00032                 MPI_Comm_size(MPI_COMM_WORLD, &amp;numRanks);
<a name="l00033"></a>00033                 MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);
<a name="l00034"></a>00034 
<a name="l00035"></a>00035                 <span class="keywordflow">if</span> (<a class="code" href="qubits_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>) {
<a name="l00036"></a>00036                         <span class="keywordtype">char</span> hostName[256];
<a name="l00037"></a>00037                         <span class="keywordtype">int</span> hostNameLen;
<a name="l00038"></a>00038                         MPI_Get_processor_name(hostName, &amp;hostNameLen);
<a name="l00039"></a>00039                         printf(<span class="stringliteral">&quot;rank %d on host %s\n&quot;</span>, rank, hostName);
<a name="l00040"></a>00040                 }
<a name="l00041"></a>00041                 env-&gt;<a class="code" href="structQuESTEnv.html#aa648bb336cf8598467cb62db00b9cee8">rank</a>=rank;
<a name="l00042"></a>00042                 env-&gt;<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>=numRanks;
<a name="l00043"></a>00043         } <span class="keywordflow">else</span> printf(<span class="stringliteral">&quot;ERROR: Trying to initialize QuESTEnv multiple times. Ignoring\n&quot;</span>);
<a name="l00044"></a>00044 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af0ea25f00987af4c53f17c9cca62ab41"></a><!-- doxytag: member="qubits_env_mpi.c::isChunkToSkipInFindPZero" ref="af0ea25f00987af4c53f17c9cca62ab41" args="(int chunkId, long long int chunkSize, int measureQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int isChunkToSkipInFindPZero </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chunkId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long long int&nbsp;</td>
          <td class="paramname"> <em>chunkSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>measureQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find chunks to skip when calculating probability of qubit being zero. </p>
<p>When calculating probability of a bit q being zero, sum up 2^q values, then skip 2^q values, etc. This function finds if an entire chunk is in the range of values to be skipped</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkId</em>&nbsp;</td><td>id of chunk in state vector </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>chunkSize</em>&nbsp;</td><td>number of amps in chunk </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>measureQubi</em>&nbsp;</td><td>qubit being measured </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>int -- 1: skip, 0: don't skip </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00650">650</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="qubits__env__mpi_8c_source.html#l00678">collapseToOutcome()</a>, and <a class="el" href="qubits__env__mpi_8c_source.html#l00659">findProbabilityOfOutcome()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00651"></a>00651 {
<a name="l00652"></a>00652         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> sizeHalfBlock = 1LL &lt;&lt; (measureQubit);
<a name="l00653"></a>00653         <span class="keywordtype">int</span> numChunksToSkip = sizeHalfBlock/chunkSize;
<a name="l00654"></a>00654         <span class="comment">// calculate probability by summing over numChunksToSkip, then skipping numChunksToSkip, etc</span>
<a name="l00655"></a>00655         <span class="keywordtype">int</span> bitToCheck = chunkId &amp; numChunksToSkip;
<a name="l00656"></a>00656         <span class="keywordflow">return</span> bitToCheck;
<a name="l00657"></a>00657 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1589779fdc2de60c784eabd8dd1c2a8c"></a><!-- doxytag: member="qubits_env_mpi.c::multiControlledUnitary" ref="a1589779fdc2de60c784eabd8dd1c2a8c" args="(MultiQubit multiQubit, int *controlQubits, const int numControlQubits, const int rotQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void multiControlledUnitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>controlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>numControlQubits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Apply a unitary operation to a single qubit given an array of control qubits Only perform the rotation for elements where all control qubits equal 1. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>controlQubits</em>&nbsp;</td><td>perform rotation if all qubits in this array equal 1 </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>numControlQubits</em>&nbsp;</td><td>number of control qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>u</em>&nbsp;</td><td>unitary matrix to apply </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00440">440</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00192">getRotAngleFromUnitaryMatrix()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8c_source.html#l01118">multiControlledUnitaryDistributed()</a>, <a class="el" href="qubits_8c_source.html#l00838">multiControlledUnitaryLocal()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>, and <a class="el" href="qubits_8c_source.html#l00383">validateMatrixIsUnitary()</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00567">test_multiControlledUnitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00441"></a>00441 {
<a name="l00442"></a>00442         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00443"></a>00443         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(numControlQubits &gt;= 0 &amp;&amp; numControlQubits &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 4, __func__);
<a name="l00444"></a>00444         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(<a class="code" href="qubits_8c.html#ae4fea133d1a8f09ff8da03038100adb2">validateMatrixIsUnitary</a>(u), 5, __func__);
<a name="l00445"></a>00445          
<a name="l00446"></a>00446         <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> mask=0;
<a name="l00447"></a>00447         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numControlQubits; i++) mask = mask | (1LL&lt;&lt;controlQubits[i]);
<a name="l00448"></a>00448         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(mask &gt;=0 &amp;&amp; mask &lt;= (1LL&lt;&lt;multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>)-1, 2, __func__);
<a name="l00449"></a>00449         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>((mask &amp; (1LL&lt;&lt;rotQubit)) != (1LL&lt;&lt;rotQubit), 3, __func__);
<a name="l00450"></a>00450         
<a name="l00451"></a>00451         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00452"></a>00452         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00453"></a>00453         <a class="code" href="structComplex.html" title="Represents one complex number.">Complex</a> rot1, rot2;
<a name="l00454"></a>00454 
<a name="l00455"></a>00455         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00456"></a>00456         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00457"></a>00457         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00458"></a>00458 
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00460"></a>00460                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00461"></a>00461                 <a class="code" href="qubits_8c.html#a32cb91618b5fcd79b54be8d8760b713d" title="Rotate a single qubit in the state vector of probability amplitudes, given two complex...">multiControlledUnitaryLocal</a>(multiQubit, rotQubit, mask, u);
<a name="l00462"></a>00462         } <span class="keywordflow">else</span> {
<a name="l00463"></a>00463                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00464"></a>00464                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00465"></a>00465                 <a class="code" href="qubits__env__mpi_8c.html#a5c9b2f129bdffaaba9857f6eddecbb17" title="Get rotation values for a given chunk given a unitary matrix.">getRotAngleFromUnitaryMatrix</a>(rankIsUpper, &amp;rot1, &amp;rot2, u);
<a name="l00466"></a>00466                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00467"></a>00467                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00468"></a>00468                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00469"></a>00469                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00470"></a>00470                 
<a name="l00471"></a>00471                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. send values to multiControlledUnitaryDistributed</span>
<a name="l00472"></a>00472                 <span class="comment">// in the correct order</span>
<a name="l00473"></a>00473                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00474"></a>00474                         <a class="code" href="qubits_8c.html#a54f4c82568e9433515c4480cdb536e27" title="Apply a unitary operation to a single qubit in the state vector of probability amplitudes...">multiControlledUnitaryDistributed</a>(multiQubit,rotQubit,mask,rot1,rot2,
<a name="l00475"></a>00475                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//upper</span>
<a name="l00476"></a>00476                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//lower</span>
<a name="l00477"></a>00477                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00478"></a>00478                 } <span class="keywordflow">else</span> {
<a name="l00479"></a>00479                         <a class="code" href="qubits_8c.html#a54f4c82568e9433515c4480cdb536e27" title="Apply a unitary operation to a single qubit in the state vector of probability amplitudes...">multiControlledUnitaryDistributed</a>(multiQubit,rotQubit,mask,rot1,rot2,
<a name="l00480"></a>00480                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//upper</span>
<a name="l00481"></a>00481                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//lower</span>
<a name="l00482"></a>00482                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00483"></a>00483                 }
<a name="l00484"></a>00484         }
<a name="l00485"></a>00485 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae275b94c1a483dda43bf4ec947635605"></a><!-- doxytag: member="qubits_env_mpi.c::phaseGate" ref="ae275b94c1a483dda43bf4ec947635605" args="(MultiQubit multiQubit, const int rotQubit, enum phaseGateType type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void phaseGate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="qubits_8h.html#a5739021c733cecc49647956b2f7338ea">phaseGateType</a>&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit by {{1,0},{0,p}} where p is a phase term determined by the type argument. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>type</em>&nbsp;</td><td>the type of phase gate to apply -- one of {SIGMA_Z, S_GATE, T_GATE} </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00583">583</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8c_source.html#l01680">phaseGateDistributed()</a>, <a class="el" href="qubits_8c_source.html#l01597">phaseGateLocal()</a>, and <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00584"></a>00584 {
<a name="l00585"></a>00585         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00588"></a>00588         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00591"></a>00591         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00594"></a>00594                 <a class="code" href="qubits_8c.html#a6a736aeb3532898019fe7c27010edc6a" title="Rotate a single qubit by {{1,0},{0,p}} where p is a phase term determined by the...">phaseGateLocal</a>(multiQubit, rotQubit, type);
<a name="l00595"></a>00595         } <span class="keywordflow">else</span> {
<a name="l00596"></a>00596                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00597"></a>00597                 <span class="keywordflow">if</span> (!rankIsUpper) <a class="code" href="qubits_8c.html#a38a05c7e749e806b182ef3b89878bfc4" title="Rotate a single qubit by {{1,0},{0,p}} where p is a phase term determined by the...">phaseGateDistributed</a>(multiQubit, rotQubit, type);
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3587b9d533e633ccf1abf9ad2ce45d8d"></a><!-- doxytag: member="qubits_env_mpi.c::QuESTAssert" ref="a3587b9d533e633ccf1abf9ad2ce45d8d" args="(int isValid, int errorCode, const char *func)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void QuESTAssert </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>isValid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>errorCode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00712">712</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits__env__local_8c_source.html#l00192">exitWithError()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00712"></a>00712                                                               {
<a name="l00713"></a>00713     <span class="keywordflow">if</span> (!isValid) <a class="code" href="qubits__env__local_8c.html#ae5f9019826f35e8b51b1716cfe397b45">exitWithError</a>(errorCode, func);
<a name="l00714"></a>00714 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a62da5b58d8ce84e6f4d24be1b872294e"></a><!-- doxytag: member="qubits_env_mpi.c::reportNodeList" ref="a62da5b58d8ce84e6f4d24be1b872294e" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reportNodeList </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Report a list of CPU hostnames and the rank that is running on each if running with MPI enabled and an error message otherwise. </p>
<p>For debugging purposes. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00078">78</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00061">QuESTEnv::rank</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00078"></a>00078                                  {
<a name="l00079"></a>00079         <span class="keywordtype">char</span> hostName[256];
<a name="l00080"></a>00080         gethostname(hostName, 255);
<a name="l00081"></a>00081         printf(<span class="stringliteral">&quot;hostname on rank %d: %s\n&quot;</span>, env.<a class="code" href="structQuESTEnv.html#aa648bb336cf8598467cb62db00b9cee8">rank</a>, hostName);
<a name="l00082"></a>00082 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8a14ae79c3fb2c0b5f6255cc37bebf9"></a><!-- doxytag: member="qubits_env_mpi.c::reportQuESTEnv" ref="af8a14ae79c3fb2c0b5f6255cc37bebf9" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void reportQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Report information about the QuEST environment. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00063">63</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00062">QuESTEnv::numRanks</a>, <a class="el" href="qubits_8h_source.html#l00061">QuESTEnv::rank</a>, and <a class="el" href="precision_8h_source.html#l00023">REAL</a>.</p>

<p>Referenced by <a class="el" href="3sat_8c_source.html#l00101">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00063"></a>00063                                  {
<a name="l00064"></a>00064         <span class="keywordflow">if</span> (env.<a class="code" href="structQuESTEnv.html#aa648bb336cf8598467cb62db00b9cee8">rank</a>==0){
<a name="l00065"></a>00065                 printf(<span class="stringliteral">&quot;EXECUTION ENVIRONMENT:\n&quot;</span>); 
<a name="l00066"></a>00066                 printf(<span class="stringliteral">&quot;Running distributed (MPI) version\n&quot;</span>);
<a name="l00067"></a>00067                 printf(<span class="stringliteral">&quot;Number of ranks is %d\n&quot;</span>, env.<a class="code" href="structQuESTEnv.html#af22aacd7c9905accae28484785c193b4">numRanks</a>);
<a name="l00068"></a>00068 <span class="preprocessor"># ifdef _OPENMP</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;OpenMP enabled\n&quot;</span>);
<a name="l00070"></a>00070                 printf(<span class="stringliteral">&quot;Number of threads available is %d\n&quot;</span>, omp_get_max_threads());
<a name="l00071"></a>00071 <span class="preprocessor"># else</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;OpenMP disabled\n&quot;</span>);
<a name="l00073"></a>00073 <span class="preprocessor"># endif </span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;Precision: size of REAL is %ld bytes\n&quot;</span>, <span class="keyword">sizeof</span>(<a class="code" href="precision_8h.html#a4b654506f18b8bfd61ad2a29a7e38c25">REAL</a>));
<a name="l00075"></a>00075         }
<a name="l00076"></a>00076 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acda82bebb0a62f419eec9c1e0575daad"></a><!-- doxytag: member="qubits_env_mpi.c::sigmaX" ref="acda82bebb0a62f419eec9c1e0575daad" args="(MultiQubit multiQubit, const int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sigmaX </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit by {{0,1},{1,0}} -- swap |0&gt; and |1&gt;. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00486">486</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8c_source.html#l01235">sigmaXDistributed()</a>, <a class="el" href="qubits_8c_source.html#l01175">sigmaXLocal()</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00078">test_sigmaX()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00487"></a>00487 {
<a name="l00488"></a>00488         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00491"></a>00491         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00494"></a>00494         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00495"></a>00495         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00498"></a>00498                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00499"></a>00499                 <a class="code" href="qubits_8c.html#aa9e640bb2d0458c937c6a87dfeca0f23" title="Rotate a single qubit by {{0,1},{1,0}.">sigmaXLocal</a>(multiQubit, rotQubit);
<a name="l00500"></a>00500         } <span class="keywordflow">else</span> {
<a name="l00501"></a>00501                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00502"></a>00502                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00503"></a>00503                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00504"></a>00504                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00505"></a>00505                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00506"></a>00506                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00507"></a>00507                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. sigmaX just replaces</span>
<a name="l00508"></a>00508                 <span class="comment">// this rank&apos;s values with pair values</span>
<a name="l00509"></a>00509                 <a class="code" href="qubits_8c.html#a5958808b2f2f05937921ba7dabe5a171" title="Rotate a single qubit by {{0,1},{1,0}.">sigmaXDistributed</a>(multiQubit, rotQubit,
<a name="l00510"></a>00510                         multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">// in</span>
<a name="l00511"></a>00511                         multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">// out</span>
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7b022c75cef77be046bd5d61e38a581e"></a><!-- doxytag: member="qubits_env_mpi.c::sigmaY" ref="a7b022c75cef77be046bd5d61e38a581e" args="(MultiQubit multiQubit, const int rotQubit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sigmaY </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rotate a single qubit by {{0,-i},{i,0}} -- swap |0&gt; and |1&gt; and apply a phase of -i or i. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>multiQubit</em>&nbsp;</td><td>object representing the set of qubits </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>rotQubit</em>&nbsp;</td><td>qubit to rotate </td></tr>
  </table>
  </dd>
</dl>

<p><p>fix -- put duplicate code (sigmaX, sigmaY) in seperate function </p>
</p>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00552">552</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8c_source.html#l01442">sigmaYDistributed()</a>, <a class="el" href="qubits_8c_source.html#l01382">sigmaYLocal()</a>, and <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00107">test_sigmaY()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00553"></a>00553 {
<a name="l00554"></a>00554         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00557"></a>00557         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00560"></a>00560         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00561"></a>00561         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00564"></a>00564                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00565"></a>00565                 <a class="code" href="qubits_8c.html#afcbb1dcbe070ad0ed1a72a23251b6a83" title="Rotate a single qubit by {{0,-i},{i,0}.">sigmaYLocal</a>(multiQubit, rotQubit);
<a name="l00566"></a>00566         } <span class="keywordflow">else</span> {
<a name="l00568"></a>00568                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00569"></a>00569                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00570"></a>00570                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00571"></a>00571                 <span class="comment">//printf(&quot;%d rank has pair rank: %d\n&quot;, multiQubit.rank, pairRank);</span>
<a name="l00572"></a>00572                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00573"></a>00573                 <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00574"></a>00574                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. sigmaX just replaces</span>
<a name="l00575"></a>00575                 <span class="comment">// this rank&apos;s values with pair values</span>
<a name="l00576"></a>00576                 <a class="code" href="qubits_8c.html#a0471f6b547ce8270ef85170b7f4f0214" title="Rotate a single qubit by {{0,-i},{i,0}.">sigmaYDistributed</a>(multiQubit,rotQubit,
<a name="l00577"></a>00577                         multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">// in</span>
<a name="l00578"></a>00578                         multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">// out</span>
<a name="l00579"></a>00579                         rankIsUpper);
<a name="l00580"></a>00580         }
<a name="l00581"></a>00581 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8d31fe2d1ad4d01e2a1f5f6b8bc15b77"></a><!-- doxytag: member="qubits_env_mpi.c::syncQuESTEnv" ref="a8d31fe2d1ad4d01e2a1f5f6b8bc15b77" args="(QuESTEnv env)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void syncQuESTEnv </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structQuESTEnv.html">QuESTEnv</a>&nbsp;</td>
          <td class="paramname"> <em>env</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Guarantees that all code up to the given point has been executed on all nodes. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00046">46</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="qubits_8c_source.html#l00334">initializeStateFromSingleFile()</a>, <a class="el" href="3sat_8c_source.html#l00101">main()</a>, <a class="el" href="qubits_8c_source.html#l00122">reportStateToScreen()</a>, and <a class="el" href="runTests_8c_source.html#l00249">test_controlledNot()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00046"></a>00046                                {
<a name="l00047"></a>00047         MPI_Barrier(MPI_COMM_WORLD);
<a name="l00048"></a>00048 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac7e38d768a1bd79019f88cc1e6295092"></a><!-- doxytag: member="qubits_env_mpi.c::syncQuESTSuccess" ref="ac7e38d768a1bd79019f88cc1e6295092" args="(int successCode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int syncQuESTSuccess </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>successCode</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Performs a logical AND on all successCodes held by all processes. </p>
<p>If any one process has a zero successCode all processes will return a zero success code. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>env</em>&nbsp;</td><td>object representing the execution environment. A single instance is used for each program </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>successCode</em>&nbsp;</td><td>1 if process task succeeded, 0 if process task failed </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if all processes succeeded, 0 if any one process failed </dd></dl>

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00050">50</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00760">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00050"></a>00050                                      {
<a name="l00051"></a>00051         <span class="keywordtype">int</span> totalSuccess;
<a name="l00052"></a>00052         MPI_Allreduce(&amp;successCode, &amp;totalSuccess, 1, MPI_INT, MPI_LAND, MPI_COMM_WORLD);
<a name="l00053"></a>00053         <span class="keywordflow">return</span> totalSuccess;
<a name="l00054"></a>00054 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae74806cf36513b6d8447439a5bc1d615"></a><!-- doxytag: member="qubits_env_mpi.c::unitary" ref="ae74806cf36513b6d8447439a5bc1d615" args="(MultiQubit multiQubit, const int rotQubit, ComplexMatrix2 u)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unitary </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structMultiQubit.html">MultiQubit</a>&nbsp;</td>
          <td class="paramname"> <em>multiQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>rotQubit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structComplexMatrix2.html">ComplexMatrix2</a>&nbsp;</td>
          <td class="paramname"> <em>u</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="qubits__env__mpi_8c_source.html#l00311">311</a> of file <a class="el" href="qubits__env__mpi_8c_source.html">qubits_env_mpi.c</a>.</p>

<p>References <a class="el" href="qubits_8h_source.html#l00051">MultiQubit::chunkId</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00146">chunkIsUpper()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00239">exchangeStateVectors()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00213">getChunkPairId()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00192">getRotAngleFromUnitaryMatrix()</a>, <a class="el" href="qubits__env__mpi_8c_source.html#l00232">halfMatrixBlockFitsInChunk()</a>, <a class="el" href="qubits_8h_source.html#l00049">MultiQubit::numAmps</a>, <a class="el" href="qubits_8h_source.html#l00046">MultiQubit::numQubits</a>, <a class="el" href="qubits_8h_source.html#l00044">MultiQubit::pairStateVec</a>, <a class="el" href="qubits__env__local_8c_source.html#l00200">QuESTAssert()</a>, <a class="el" href="qubits_8h_source.html#l00042">MultiQubit::stateVec</a>, <a class="el" href="qubits_8c_source.html#l00704">unitaryDistributed()</a>, <a class="el" href="qubits_8c_source.html#l00575">unitaryLocal()</a>, and <a class="el" href="qubits_8c_source.html#l00383">validateMatrixIsUnitary()</a>.</p>

<p>Referenced by <a class="el" href="runTests_8c_source.html#l00403">test_unitary()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00312"></a>00312 {
<a name="l00313"></a>00313         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(rotQubit &gt;= 0 &amp;&amp; rotQubit &lt; multiQubit.<a class="code" href="structMultiQubit.html#ab5b9795bdc6fb5855e1974dcbbaeb36f" title="Number of qubits in the state.">numQubits</a>, 1, __func__);
<a name="l00314"></a>00314         <a class="code" href="qubits__env__local_8c.html#a3587b9d533e633ccf1abf9ad2ce45d8d">QuESTAssert</a>(<a class="code" href="qubits_8c.html#ae4fea133d1a8f09ff8da03038100adb2">validateMatrixIsUnitary</a>(u), 5, __func__);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">// flag to require memory exchange. 1: an entire block fits on one rank, 0: at most half a block fits on one rank</span>
<a name="l00317"></a>00317         <span class="keywordtype">int</span> useLocalDataOnly = <a class="code" href="qubits__env__mpi_8c.html#a6d968d42f466bd03cea5edba456e10f7" title="return whether the current qubit rotation will use blocks that fit within a single...">halfMatrixBlockFitsInChunk</a>(multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00318"></a>00318         <a class="code" href="structComplex.html" title="Represents one complex number.">Complex</a> rot1, rot2;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="comment">// rank&apos;s chunk is in upper half of block </span>
<a name="l00321"></a>00321         <span class="keywordtype">int</span> rankIsUpper;
<a name="l00322"></a>00322         <span class="keywordtype">int</span> pairRank; <span class="comment">// rank of corresponding chunk</span>
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         <span class="keywordflow">if</span> (useLocalDataOnly){
<a name="l00325"></a>00325                 <span class="comment">// all values required to update state vector lie in this rank</span>
<a name="l00326"></a>00326                 <a class="code" href="qubits_8c.html#a5fd78353771c9a34832e7a3b1e90f4db">unitaryLocal</a>(multiQubit, rotQubit, u);
<a name="l00327"></a>00327         } <span class="keywordflow">else</span> {
<a name="l00328"></a>00328                 <span class="comment">// need to get corresponding chunk of state vector from other rank</span>
<a name="l00329"></a>00329                 rankIsUpper = <a class="code" href="qubits__env__mpi_8c.html#a814c41ee59e206c362f2eaf1def88be6" title="Returns whether a given chunk in position chunkId is in the upper or lower half of...">chunkIsUpper</a>(multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00330"></a>00330                 <a class="code" href="qubits__env__mpi_8c.html#a5c9b2f129bdffaaba9857f6eddecbb17" title="Get rotation values for a given chunk given a unitary matrix.">getRotAngleFromUnitaryMatrix</a>(rankIsUpper, &amp;rot1, &amp;rot2, u);
<a name="l00331"></a>00331                 pairRank = <a class="code" href="qubits__env__mpi_8c.html#af5bdeedf4a445b539d329c3000859f5a" title="get position of corresponding chunk, holding values required to update values in...">getChunkPairId</a>(rankIsUpper, multiQubit.<a class="code" href="structMultiQubit.html#ab10c88249fa3825d6227ceec01d37e37" title="The position of the chunk of the state vector held by this process in the full state...">chunkId</a>, multiQubit.<a class="code" href="structMultiQubit.html#ae16f47d8b725c914fb7f66b6498d79db" title="Number of probability amplitudes held in stateVec by this process In the non-MPI...">numAmps</a>, rotQubit);
<a name="l00332"></a>00332                 <span class="comment">// get corresponding values from my pair</span>
<a name="l00333"></a>00333                         <a class="code" href="qubits__env__mpi_8c.html#a7682c9a3fd592d34ec15ba8fa172f104">exchangeStateVectors</a>(multiQubit, pairRank);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335                 <span class="comment">// this rank&apos;s values are either in the upper of lower half of the block. </span>
<a name="l00336"></a>00336                 <span class="comment">// send values to compactUnitaryDistributed in the correct order</span>
<a name="l00337"></a>00337                 <span class="keywordflow">if</span> (rankIsUpper){
<a name="l00338"></a>00338                         <a class="code" href="qubits_8c.html#af538f02e700f4d022044fc71030a6953" title="Apply a unitary operation to a single qubit given a subset of the state vector with...">unitaryDistributed</a>(multiQubit,rotQubit,rot1,rot2,
<a name="l00339"></a>00339                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//upper</span>
<a name="l00340"></a>00340                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//lower</span>
<a name="l00341"></a>00341                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00342"></a>00342                 } <span class="keywordflow">else</span> {
<a name="l00343"></a>00343                         <a class="code" href="qubits_8c.html#af538f02e700f4d022044fc71030a6953" title="Apply a unitary operation to a single qubit given a subset of the state vector with...">unitaryDistributed</a>(multiQubit,rotQubit,rot1,rot2,
<a name="l00344"></a>00344                                 multiQubit.<a class="code" href="structMultiQubit.html#a76f7db4eab52d2b30f58f973ada809c5" title="Temporary storage for a chunk of the state vector received from another process in...">pairStateVec</a>, <span class="comment">//upper</span>
<a name="l00345"></a>00345                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>, <span class="comment">//lower</span>
<a name="l00346"></a>00346                                 multiQubit.<a class="code" href="structMultiQubit.html#a45483190d6b01ef6b2f98f2bec9ab94f" title="Probablilty amplitudes for the multi qubit state.">stateVec</a>); <span class="comment">//output</span>
<a name="l00347"></a>00347                 }
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 5 Feb 2018 for Distributed QuEST by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
